{
  servers {
    trusted_proxies static private_ranges
  }
}

{$BASE_URL} {
  route {
    handle_path /api/* {
      reverse_proxy http://backend:8000 {
        # Remove Set-Cookie "Secure" flag when running in HTTP
        # header_down Set-Cookie "^(.*); Secure(;.*)?$" "$1$2"
      }
    }
    file_server {
      root /data/uploads
      pass_thru
    }
    handle_path /thumbs/* {
      file_server {
        root /data/thumbs
        pass_thru
      }
    }
    reverse_proxy http://web:3000
  }
}
